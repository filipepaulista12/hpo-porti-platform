<VirtualHost *:80>
    ServerName hpo.raras-cplp.org
    ServerAlias www.hpo.raras-cplp.org
    
    DocumentRoot /var/www/html/hpo-platform/public
    
    <Directory /var/www/html/hpo-platform/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # React Router - todas as rotas vão para index.html
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>
    
    # Proxy para API backend (Node.js na porta 3002)
    ProxyPreserveHost On
    ProxyPass /api http://localhost:3002/api
    ProxyPassReverse /api http://localhost:3002/api
    
    # WebSocket support
    ProxyPass /socket.io http://localhost:3002/socket.io
    ProxyPassReverse /socket.io http://localhost:3002/socket.io
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:3002/$1" [P,L]
    
    # Headers de segurança
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/hpo-error.log
    CustomLog ${APACHE_LOG_DIR}/hpo-access.log combined
</VirtualHost>
