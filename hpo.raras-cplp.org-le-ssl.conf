<IfModule mod_ssl.c>
<VirtualHost *:443>
  ServerName hpo.raras-cplp.org
  ServerAlias www.hpo.raras-cplp.org
  DocumentRoot /var/www/html/hpo-platform/public
  
  <Directory /var/www/html/hpo-platform/public>
    Options -Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
    
    # React Router - todas as rotas v√£o para index.html
    RewriteEngine On
    RewriteBase /
    RewriteRule ^index\.html$ - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule . /index.html [L]
  </Directory>
  
  # Proxy para API backend - Passar tudo sem modificar
  ProxyPreserveHost On
  
  # Rota /health (com e sem /api)
  ProxyPass /health http://localhost:3002/health
  ProxyPassReverse /health http://localhost:3002/health
  ProxyPass /api/health http://localhost:3002/health
  ProxyPassReverse /api/health http://localhost:3002/health
  
  # Todas as outras rotas /api/*
  ProxyPass /api http://localhost:3002/api
  ProxyPassReverse /api http://localhost:3002/api
  
  # WebSocket support
  ProxyPass /socket.io http://localhost:3002/socket.io
  ProxyPassReverse /socket.io http://localhost:3002/socket.io
  
  # Security Headers
  Header always set X-Frame-Options SAMEORIGIN
  Header always set X-Content-Type-Options nosniff
  
  # Logs
  ErrorLog /var/log/apache2/hpo-error.log
  CustomLog /var/log/apache2/hpo-access.log combined

Include /etc/letsencrypt/options-ssl-apache.conf
SSLCertificateFile /etc/letsencrypt/live/hpo.raras-cplp.org/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/hpo.raras-cplp.org/privkey.pem
</VirtualHost>
</IfModule>
